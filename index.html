<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plataforma de Locales</title>
  <link rel="icon" href="logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    :root{--azul:#003366;--azul-2:#001122;--amarillo:#ffcc00;--bg:#f8f9fa;--text:#1f2937;--card:#fff;}
    *{box-sizing:border-box;margin:0;padding:0}body{font-family:'Roboto',sans-serif;background:var(--bg);color:var(--text)}
    header{background:linear-gradient(90deg,var(--azul) 0%,var(--azul-2) 100%);color:#fff;padding:1.2rem}
    header h1{max-width:980px;margin:0 auto;font-size:1.6rem}
    main{max-width:980px;margin:0 auto;padding:1rem}
    .toolbar{display:flex;gap:.6rem;flex-wrap:wrap;margin:.6rem 0 1rem}
    .toolbar input{flex:1;min-width:220px;padding:.8rem 1rem;border-radius:12px;border:1px solid #cbd5e1;font-size:1rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;display:grid}
    .cover{aspect-ratio:16/9;background:#e5e7eb;display:grid;place-items:center}
    .card h3{padding:.6rem .8rem .2rem;font-size:1.05rem}
    .meta{padding:0 .8rem .6rem;color:#64748b;font-size:.9rem}
    .badge{display:inline-block;margin:.4rem .8rem;background:#fffae6;border:1px solid #fde68a;color:#92400e;padding:.15rem .5rem;border-radius:999px;font-weight:800;font-size:.8rem}
    .cta{margin:.6rem .8rem 1rem}
    .cta a{display:inline-flex;align-items:center;gap:.45rem;background:var(--azul);color:var(--amarillo);padding:.6rem 1rem;border-radius:12px;text-decoration:none;font-weight:800;border:2px solid var(--amarillo)}
    .section{margin-top:1rem}
    .section h2{font-size:1.1rem;margin:.6rem 0}
    .empty{opacity:.7;margin:.8rem 0}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:.6rem;flex-wrap:wrap}
    .link{color:#0b5ed7;text-decoration:none}
  </style>
</head>
<body>
<header>
  <h1>Todos los locales</h1>
</header>
<main>
  <div class="topbar">
    <div class="toolbar">
      <input id="q" type="search" placeholder="Buscar por nombre, categorÃ­a, barrio..." />
    </div>
    <div><a class="link" href="registro.html">+ Registrar mi local</a></div>
  </div>

  <div id="contenedor"></div>
  <p id="vacio" class="empty" hidden>No encontramos locales con ese filtro.</p>
</main>

<script>
const cont = document.getElementById('contenedor');
const empty = document.getElementById('vacio');
const q = document.getElementById('q');

function groupBy(xs, key) { return xs.reduce((acc, x) => { (acc[x[key]] = acc[x[key]] || []).push(x); return acc; }, {}); }

function render(list){
  cont.innerHTML='';
  const byCat = groupBy(list, 'categoria');
  const cats = Object.keys(byCat).sort((a,b)=>a.localeCompare(b));
  cats.forEach(cat=>{
    const sec = document.createElement('section'); sec.className='section';
    sec.innerHTML = `<h2>${cat}</h2><div class="grid" id="g-${cat}"></div>`;
    cont.appendChild(sec);
    const grid = sec.querySelector('.grid');
    byCat[cat].sort((a,b)=>a.nombre.localeCompare(b.nombre)).forEach(loc=>{
      const card = document.createElement('div'); card.className='card';
      const cover = loc.portada || 'logo.png';
      card.innerHTML = `
        <div class="cover"><img src="${cover}" alt="${loc.nombre}" style="max-width:100%;max-height:100%"></div>
        <span class="badge">${loc.categoria}</span>
        <h3>${loc.nombre}</h3>
        <div class="meta">${loc.direccion||''}</div>
        <div class="cta"><a href="app.html?l=${encodeURIComponent(loc.slug)}">Abrir local</a></div>
      `;
      grid.appendChild(card);
    });
  });
}

let LOCALES = [];
async function boot(){
  LOCALES = await fetch('data/locales.json').then(r=>r.json()).catch(()=>[]);
  render(LOCALES);
}
boot();

q.addEventListener('input', ()=>{
  const v = q.value.trim().toLowerCase();
  const filtered = LOCALES.filter(l => [l.nombre,l.categoria,l.direccion,l.barrio,l.tags?.join(' ')].join(' ').toLowerCase().includes(v));
  render(filtered);
  empty.hidden = filtered.length>0;
});
</script>
</body>
</html>
