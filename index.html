<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Zonaap</title>
  <link rel="icon" href="assets/favicon-32.png">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet"/>
  <style>
    :root{--azul:#0b315f;--amarillo:#ffc400}
    body{font-family:Roboto,system-ui,Arial,sans-serif;margin:0;background:#f3f4f6;color:#0f172a}
    header{background:linear-gradient(90deg,#0b315f,#001a33);padding:40px 16px 28px;text-align:center}
    .brand{display:grid;place-items:center}
    .brand svg{width:min(88vw,680px);height:auto;display:block}
    main{max-width:980px;margin:0 auto;padding:16px}
    .hero-title{color:#fff;font-size:28px;font-weight:900;margin:8px 0 4px}
    .hero-sub{color:#cbd5e1;margin:0 0 22px}
    .search-row{display:flex;gap:12px;align-items:center}
    .search{flex:1;border:1px solid #e2e8f0;border-radius:14px;padding:14px 16px;font-size:16px}
    .btn{background:var(--azul);color:#fff;border:2px solid var(--amarillo);padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:20px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:12px;display:flex;gap:10px;align-items:center}
    .card img{width:56px;height:56px;border-radius:12px;object-fit:cover;border:1px solid #e5e7eb}
    .card .name{font-weight:900}
    .muted{color:#64748b}
    footer{padding:36px 16px;text-align:center;color:#64748b}
    @media (min-width:960px){ .hero-title{font-size:34px} }
  </style>
</head>
<body>
  <header>
    <div class="brand" aria-label="zonaap">
      <svg viewBox="0 0 1000 240" role="img" aria-label="zonaap" preserveAspectRatio="xMidYMid meet">
        <defs>
          <style>
            .t{font-family:'Roboto',sans-serif;font-weight:900;font-size:164px;letter-spacing:-0.8px;text-anchor:middle}
            .w{fill:#ffffff}.y{fill:var(--amarillo)}
            .s{fill:none;stroke:#0006;stroke-width:10;stroke-linejoin:round}
          </style>
        </defs>
        <text class="t s" x="500" y="172">zonaap</text>
        <text class="t" x="500" y="172"><tspan class="w">zon</tspan><tspan class="y">aa</tspan><tspan class="w">p</tspan></text>
      </svg>
    </div>
    <h1 class="hero-title">Pedí online a negocios de tu barrio</h1>
    <p class="hero-sub">Buscá un local o registrá el tuyo gratis.</p>
    <div class="search-row" style="max-width:980px;margin:0 auto;">
      <input id="q" class="search" placeholder="Buscar por nombre, rubro o barrio…"/>
      <button class="btn" onclick="location.href='registro.html'">+ Registrar mi local</button>
      <a href="/admin/" data-admin-link style="margin-left:6px;color:#fff;text-decoration:underline;font-weight:800">Entrar al panel</a>
    </div>
  </header>

  <main>
    <div id="cards" class="cards" aria-live="polite"></div>
  </main>

  <footer>
    Hecho con ❤️ para emprendedores. Gratis y simple.
  </footer>

  <script>
    // Helper: soportar {locales:[...]} o array plano
    function getLocales(payload){ try{ if(Array.isArray(payload)) return payload; if(payload && Array.isArray(payload.locales)) return payload.locales; }catch(e){} return []; }

    async function load(){
      const raw = await (await fetch('data/locales.json', {cache:'no-store'})).json();
      const locales = getLocales(raw);
      const q = document.getElementById('q');
      const cards = document.getElementById('cards');

      function render(list){
        cards.innerHTML = '';
        list.forEach(l => {
          const a = document.createElement('a');
          a.href = `negocio.html?l=${encodeURIComponent(l.slug)}`;
          a.className = 'card';
          a.innerHTML = `<img src="${l.logo || 'assets/zonaap-pro-wordmark-centered.svg'}" alt="${l.nombre}"><div><div class="name">${l.nombre}</div><div class="muted">${[l.rubro,l.barrio].filter(Boolean).join(' • ')}</div></div>`;
          cards.appendChild(a);
        });
      }

      render(locales);

      q.addEventListener('input', () => {
        const s = q.value.trim().toLowerCase();
        const filtered = locales.filter(l => [l.nombre,l.rubro,l.barrio].join(' ').toLowerCase().includes(s));
        render(filtered);
      });
    }
    load();
  </script>

  <!-- Identity (seguro, sin auto-redirect) -->
  <script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    (function(){
      function ready(fn){ if(document.readyState!=='loading'){ fn(); } else { document.addEventListener('DOMContentLoaded', fn); } }
      ready(function(){
        var ni = window.netlifyIdentity;
        if (window.location.hash && window.location.hash.indexOf('invite_token') !== -1 && ni) {
          ni.on('init', function(){ ni.open('signup'); });
        }
        document.querySelectorAll('[data-admin-link]').forEach(function(a){
          a.addEventListener('click', function(e){
            e.preventDefault();
            if (!ni) { window.location.href = '/admin/'; return; }
            if (ni.currentUser()) { window.location.href = '/admin/'; }
            else { ni.open('login'); ni.once('login', function(){ window.location.href = '/admin/'; }); }
          });
        });
      });
    })();
  </script>
</body>
</html>
